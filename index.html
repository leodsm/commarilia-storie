<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ComMarília</title>
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='50' fill='%23FFF'/%3E%3Ctext x='50' y='68' font-family='Poppins, sans-serif' font-size='40' font-weight='900' text-anchor='middle'%3E%3Ctspan fill='%23F4A261'%3EC%3C/tspan%3E%3Ctspan fill='%231D3557'%3EM%3C/tspan%3E%3C/text%3E%3C/svg%3E">

    <!-- Bibliotecas e Estilos Globais -->
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/feather-icons"></script>

    <!-- Bibliotecas JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/relativeTime.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/locale/pt-br.js"></script>
    
    <!-- Bibliotecas do Editor -->
    <script src="https://releases.transloadit.com/uppy/v3.3.1/uppy.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    <link href="https://releases.transloadit.com/uppy/v3.3.1/uppy.min.css" rel="stylesheet">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

</head>
<body class="bg-gray-100 text-gray-800">

    <!-- ================================================================= -->
    <!-- ==================   SEÇÃO DO VISUALIZADOR   ==================== -->
    <!-- ================================================================= -->
    <div id="viewer-section">
        <!-- Menu Lateral -->
        <aside id="side-menu" class="fixed top-0 left-0 h-full w-72 bg-white shadow-2xl z-[70] p-6 flex flex-col">
            <div class="flex justify-between items-center mb-8">
                <div class="text-2xl font-black"><span class="logo-text-com">Com</span><span class="logo-text-marilia">Marília.</span></div>
                <button id="close-menu-btn" class="text-gray-500 hover:text-gray-800" aria-label="Fechar menu"><i data-feather="x" class="w-6 h-6"></i></button>
            </div>
            <nav>
                <a href="#" class="block py-3 px-4 rounded-lg font-semibold text-gray-700 hover:bg-gray-100 hover:text-gray-900">Página Inicial</a>
                <a href="#" class="block py-3 px-4 rounded-lg font-semibold text-gray-700 hover:bg-gray-100 hover:text-gray-900">Marília</a>
                <a href="#" class="block py-3 px-4 rounded-lg font-semibold text-gray-700 hover:bg-gray-100 hover:text-gray-900">Região</a>
            </nav>
        </aside>
        <div id="menu-overlay" class="fixed inset-0 bg-black bg-opacity-60 z-[60] hidden backdrop-blur-sm"></div>

        <!-- Cabeçalho Principal -->
        <header class="bg-white/80 backdrop-blur-lg shadow-sm sticky top-0 z-40">
            <div class="container mx-auto px-4 py-4 flex justify-between items-center max-w-5xl">
                <button id="menu-btn" class="text-gray-600 hover:text-gray-900 focus:outline-none" aria-label="Abrir menu"><i data-feather="menu" class="w-6 h-6"></i></button>
                <div class="text-2xl font-black"><span class="logo-text-com">Com</span><span class="logo-text-marilia">Marília.</span></div>
                <a href="#editor" class="text-gray-600 hover:text-gray-900 focus:outline-none" aria-label="Aceder ao editor"><i data-feather="edit" class="w-6 h-6"></i></a>
            </div>
        </header>

        <!-- Conteúdo Principal com os Cards de Notícias -->
        <main class="container mx-auto px-4 py-8 max-w-5xl">
            <h1 class="text-3xl font-bold mb-6 text-gray-900">Últimas Notícias</h1>
            <div id="news-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Cards de Notícias são gerados dinamicamente -->
            </div>
        </main>

        <!-- Player de Web Story -->
        <div id="story-viewer" class="fixed inset-0 bg-black z-50 flex items-center justify-center" role="dialog" aria-modal="true">
            <div class="swiper-container-vertical">
                <div class="swiper-wrapper" id="story-swiper-wrapper"></div>
            </div>
        </div>

        <!-- Modal da Matéria Completa -->
        <div id="story-modal" class="fixed inset-0 z-[80] flex items-end sm:items-center sm:justify-center">
            <div id="story-modal-overlay" class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>
            <div id="story-modal-content" class="relative bg-white w-full max-h-[90vh] sm:max-w-2xl rounded-t-2xl sm:rounded-2xl flex flex-col">
                <div class="p-4 border-b flex justify-between items-center">
                    <h3 id="modal-title" class="text-lg font-bold text-gray-800"></h3>
                    <button id="close-modal-btn" class="text-gray-500 hover:text-gray-800"><i data-feather="x" class="w-6 h-6"></i></button>
                </div>
                <div class="p-6 overflow-y-auto hide-scrollbar">
                    <img id="modal-image" src="" alt="" class="w-full h-auto rounded-lg mb-4 object-cover">
                    <div id="modal-text" class="prose-styles text-gray-700"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ================================================================= -->
    <!-- =====================   SEÇÃO DO EDITOR   ======================= -->
    <!-- ================================================================= -->
    <div id="editor-section" class="hidden">
        <div class="editor-grid">
            <!-- Coluna 1: Lista de Stories -->
            <aside class="bg-slate-100 border-r border-slate-200 flex flex-col h-full">
                <header class="p-4 border-b border-slate-200 flex-shrink-0">
                    <div class="flex justify-between items-center">
                        <h1 class="text-xl font-bold text-gray-800">Gestão de Conteúdo</h1>
                        <a href="#" class="text-gray-600 hover:text-gray-900" title="Voltar para o site"><i data-feather="eye"></i></a>
                    </div>
                    <button id="add-post-btn" class="w-full mt-4 bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">Criar Novo Post</button>
                </header>
                <div id="stories-list" class="overflow-y-auto p-2">
                    <p class="text-center text-gray-500 p-8">A carregar...</p>
                </div>
            </aside>

            <!-- Coluna 2: Formulário de Edição -->
            <main class="h-full overflow-y-auto">
                <form id="post-form" class="p-6 space-y-6">
                    <input type="hidden" id="post-id">
                    
                    <div class="p-4 bg-white rounded-lg border">
                        <h3 class="font-bold text-lg mb-4 border-b pb-2">Dados Principais</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="category" class="font-semibold text-sm text-gray-700 block mb-1">Categoria</label>
                                <input type="text" id="category" class="w-full p-2 border rounded-lg" placeholder="Ex: Marília">
                            </div>
                            <div>
                                <label for="categoryColor" class="font-semibold text-sm text-gray-700 block mb-1">Cor da Categoria</label>
                                <input type="color" id="categoryColor" class="w-full p-1 h-10 border rounded-lg" value="#F4A261">
                            </div>
                            <div>
                                <label for="cardTitle" class="font-semibold text-sm text-gray-700 block mb-1">Título do Card</label>
                                <input type="text" id="cardTitle" class="w-full p-2 border rounded-lg" placeholder="Título que aparece no card">
                            </div>
                            <div>
                                <label class="font-semibold text-sm text-gray-700 block mb-1">Imagem do Card</label>
                                <div id="uppy-card-image"></div>
                                <input type="hidden" id="cardImage">
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-4 bg-white rounded-lg border">
                        <h3 class="font-bold text-lg mb-4 border-b pb-2">Matéria Completa</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="font-semibold text-sm text-gray-700 block mb-1">Imagem da Matéria</label>
                                <div id="uppy-full-content-image"></div>
                                <input type="hidden" id="fullContentImage">
                            </div>
                            <div>
                                <label for="fullContentTitle" class="font-semibold text-sm text-gray-700 block mb-1">Título da Matéria</label>
                                <input type="text" id="fullContentTitle" class="w-full p-2 border rounded-lg" placeholder="Título completo da matéria">
                            </div>
                            <div>
                                <label class="font-semibold text-sm text-gray-700 block mb-1">Corpo da Matéria</label>
                                <div id="editor-container"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-4 bg-white rounded-lg border">
                        <h3 class="font-bold text-lg mb-4 border-b pb-2">Páginas do Story (arraste para reordenar)</h3>
                        <div id="pages-container" class="space-y-4"></div>
                        <button type="button" id="add-page-btn" class="w-full mt-4 bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300">Adicionar Página</button>
                    </div>

                    <div class="p-4 bg-white rounded-lg border sticky bottom-0 bg-opacity-90 backdrop-blur-sm">
                        <h3 class="font-bold text-lg mb-4 border-b pb-2">Publicação</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                            <div>
                                <label for="status" class="font-semibold text-sm text-gray-700 block mb-1">Status</label>
                                <select id="status" class="w-full p-2 border rounded-lg">
                                    <option value="published">Publicado</option>
                                    <option value="draft">Rascunho</option>
                                    <option value="scheduled">Agendado</option>
                                </select>
                            </div>
                            <div id="schedule-container" class="hidden">
                                <label for="timestamp" class="font-semibold text-sm text-gray-700 block mb-1">Data de Publicação</label>
                                <input type="datetime-local" id="timestamp" class="w-full p-2 border rounded-lg">
                            </div>
                            <div class="flex gap-2">
                                 <button type="button" id="delete-btn" class="w-full bg-red-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-700 hidden">Excluir</button>
                                 <button type="button" id="save-btn" class="w-full bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700">Salvar</button>
                            </div>
                        </div>
                    </div>
                </form>
            </main>
            
            <!-- Coluna 3: Pré-visualização -->
            <aside class="bg-slate-800 flex items-center justify-center p-8 h-full">
               <div class="story-preview-container">
                    <div class="swiper-container w-full h-full">
                        <div class="swiper-wrapper" id="preview-swiper-wrapper"></div>
                    </div>
                    <div class="swiper-button-next text-white after:!text-2xl"></div>
                    <div class="swiper-button-prev text-white after:!text-2xl"></div>
               </div>
            </aside>
        </div>
    </div>
    
    <!-- Script Unificado -->
    <script src="script.js"></script>
</body>
</html>
